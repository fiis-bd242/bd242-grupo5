# 8.1. Sentencias SQL por módulo / prototipo
| Codigo Requerimiento  |R-09| 
|-----------------------|-------|
| Codigo Interfaz       |I-011| 
| Imagen interfaz       |![image](I011.png)|

## Sentencias SQL
### Eventos:
* **Carga de la página de Contratos:** Se llenará la tabla de todos los contratos en MallPlaza
```sql
SELECT
    ca.id_contrato AS "Nro Contrato",
    p.nombre AS "Inquilino",
    ec.tipo_inmueble AS "Inmueble",
    ca.fecha_inicio AS "Fecha Inicio",
    ca.fecha_vencimiento AS "Fecha Fin",
    ca.estado AS "Estado",
    ca.monto AS "Monto Renta"
FROM
    Contrato_Alquiler ca
JOIN
    Espacio_Comercial ec ON ca.id_espacio_comercial = ec.id_espacio_comercial
JOIN
    Inquilino i ON ec.id_espacio_comercial = i.id_espacio_comercial
JOIN
    Persona p ON i.id_persona = p.id_persona
ORDER BY
    ca.id_contrato;

```

* **Filtrar por tipo de inmueble :** El usuario elegirá el filtro "Tipo de inmueble" dentro del cuadro de opciones para realizar la consulta y poder mostrar los contratos con el tipo de inmueble seleccionado.
```sql
SELECT
    ca.id_contrato AS "Nro Contrato",
    p.nombre AS "Inquilino",
    ec.tipo_inmueble AS "Inmueble",
    ca.fecha_inicio AS "Fecha Inicio",
    ca.fecha_vencimiento AS "Fecha Fin",
    ca.estado AS "Estado",
    ca.monto AS "Monto Renta"
FROM
    Contrato_Alquiler ca
JOIN
    Espacio_Comercial ec ON ca.id_espacio_comercial = ec.id_espacio_comercial
JOIN
    Inquilino i ON ec.id_espacio_comercial = i.id_espacio_comercial
JOIN
    Persona p ON i.id_persona = p.id_persona
WHERE ec.tipo_inmueble = <1>;

```

*Donde el valor seleccionado en <1> es utilizado para realizar la búsqueda de los contratos que posean esas caracteristicas*

* **Filtrar por Contratos recientes :** El usuario elegirá el filtro "Contratos recientes" dentro del cuadro de opciones para realizar la consulta y poder mostrar los contratos que se hayan registrado recientemente.
```sql
SELECT
    ca.id_contrato AS "Nro Contrato",
    p.nombre AS "Inquilino",
    ec.tipo_inmueble AS "Inmueble",
    ca.fecha_inicio AS "Fecha Inicio",
    ca.fecha_vencimiento AS "Fecha Fin",
    ca.estado AS "Estado",
    ca.monto AS "Monto Renta"
FROM
    Contrato_Alquiler ca
JOIN
    Espacio_Comercial ec ON ca.id_espacio_comercial = ec.id_espacio_comercial
JOIN
    Inquilino i ON ec.id_espacio_comercial = i.id_espacio_comercial
JOIN
    Persona p ON i.id_persona = p.id_persona
ORDER BY ca.fecha_inicio DESC;

```

* **Filtrar por Contratos proximos a vencer :** El usuario elegirá el filtro "Proximos a vencer" dentro del cuadro de opciones para realizar la consulta y poder mostrar los resultados.
```sql
SELECT
    ca.id_contrato AS "Nro Contrato",
    p.nombre AS "Inquilino",
    ec.tipo_inmueble AS "Inmueble",
    ca.fecha_inicio AS "Fecha Inicio",
    ca.fecha_vencimiento AS "Fecha Fin",
    ca.estado AS "Estado",
    ca.monto AS "Monto Renta"
FROM
    Contrato_Alquiler ca
JOIN
    Espacio_Comercial ec ON ca.id_espacio_comercial = ec.id_espacio_comercial
JOIN
    Inquilino i ON ec.id_espacio_comercial = i.id_espacio_comercial
JOIN
    Persona p ON i.id_persona = p.id_persona
ORDER BY ca.fecha_vencimiento DESC;

```

* **Filtrar por estado :** El usuario elegirá el filtro "Estado" dentro del cuadro de opciones para realizar la consulta y poder mostrar los contratos con el tipo de estado seleccionado.
```sql
SELECT
    ca.id_contrato AS "Nro Contrato",
    p.nombre AS "Inquilino",
    ec.tipo_inmueble AS "Inmueble",
    ca.fecha_inicio AS "Fecha Inicio",
    ca.fecha_vencimiento AS "Fecha Fin",
    ca.estado AS "Estado",
    ca.monto AS "Monto Renta"
FROM
    Contrato_Alquiler ca
JOIN
    Espacio_Comercial ec ON ca.id_espacio_comercial = ec.id_espacio_comercial
JOIN
    Inquilino i ON ec.id_espacio_comercial = i.id_espacio_comercial
JOIN
    Persona p ON i.id_persona = p.id_persona
WHERE ca.estado = <4>;


```

*Donde el valor seleccionado en <4> es utilizado para realizar la búsqueda de los contratos con el respectivo tipo de estado*

| Codigo Requerimiento  |R-10| 
|-----------------------|-------|
| Codigo Interfaz       |I-012| 
| Imagen interfaz       |![image](I012.png)|

## Sentencias SQL
### Eventos:
* **Carga de los espacios comerciales/objetos de alquiler:** Se llenará la tabla de todos los espacios comerciales dentro de MallPlaza
```sql
SELECT 
    Espacio_Comercial.id_espacio_comercial AS "Código",
    Zonas.referencia AS "Referencia",
    Zonas.nombre_zona AS "Zona",
    Espacio_Comercial.tipo_inmueble AS "Tipo de Inmueble",
    Espacio_Comercial.tarifa AS "Tarifa",
    Espacio_Comercial.area AS "Área total",
    Espacio_Comercial.estado AS "Estado"
FROM 
    Espacio_Comercial
JOIN 
    Zonas ON Espacio_Comercial.nombre_zona = Zonas.nombre_zona;

```

* **Filtrar por tipo de inmueble :** El usuario elegirá el filtro "Tipo de inmueble" dentro del cuadro de opciones para realizar la consulta y poder mostrar los espacios comerciales con el tipo de inmueble seleccionado.
```sql
SELECT 
    Espacio_Comercial.id_espacio_comercial AS "Código",
    Zonas.referencia AS "Referencia",
    Zonas.nombre_zona AS "Zona",
    Espacio_Comercial.tipo_inmueble AS "Tipo de Inmueble",
    Espacio_Comercial.tarifa AS "Tarifa",
    Espacio_Comercial.area AS "Área total",
    Espacio_Comercial.estado AS "Estado"
FROM 
    Espacio_Comercial
JOIN 
    Zonas ON Espacio_Comercial.nombre_zona = Zonas.nombre_zona
WHERE
    Espacio_Comercial.tipo_inmueble = <1>;
    
```

*Donde el valor seleccionado en <1> es utilizado para realizar la búsqueda de los espacios comerciales que posean esas caracteristicas*

* **Filtrar por Mayor tarifa :** El usuario elegirá el filtro "Mayor tarifa" dentro del cuadro de opciones para realizar la consulta y poder mostrar los contratos con mayor tarifa.
```sql
SELECT 
    Espacio_Comercial.id_espacio_comercial AS "Código",
    Zonas.referencia AS "Referencia",
    Zonas.nombre_zona AS "Zona",
    Espacio_Comercial.tipo_inmueble AS "Tipo de Inmueble",
    Espacio_Comercial.tarifa AS "Tarifa",
    Espacio_Comercial.area AS "Área total",
    Espacio_Comercial.estado AS "Estado"
FROM 
    Espacio_Comercial
JOIN 
    Zonas ON Espacio_Comercial.nombre_zona = Zonas.nombre_zona
ORDER BY 
    Espacio_Comercial.tarifa DESC;

```

* **Filtrar por Menor tarifa :** El usuario elegirá el filtro "Menor tarifa" dentro del cuadro de opciones para realizar la consulta y poder mostrar los resultados.
```sql
SELECT 
    Espacio_Comercial.id_espacio_comercial AS "Código",
    Zonas.referencia AS "Referencia",
    Zonas.nombre_zona AS "Zona",
    Espacio_Comercial.tipo_inmueble AS "Tipo de Inmueble",
    Espacio_Comercial.tarifa AS "Tarifa",
    Espacio_Comercial.area AS "Área total",
    Espacio_Comercial.estado AS "Estado"
FROM 
    Espacio_Comercial
JOIN 
    Zonas ON Espacio_Comercial.nombre_zona = Zonas.nombre_zona
ORDER BY 
    Espacio_Comercial.tarifa ASC;

```

* **Filtrar por estado :** El usuario elegirá el filtro "Estado" dentro del cuadro de opciones para realizar la consulta y poder mostrar los contratos con el tipo de estado seleccionado.
```sql
SELECT 
    Espacio_Comercial.id_espacio_comercial AS "Código",
    Zonas.referencia AS "Referencia",
    Zonas.nombre_zona AS "Zona",
    Espacio_Comercial.tipo_inmueble AS "Tipo de Inmueble",
    Espacio_Comercial.tarifa AS "Tarifa",
    Espacio_Comercial.area AS "Área total",
    Espacio_Comercial.estado AS "Estado"
FROM 
    Espacio_Comercial
JOIN 
    Zonas ON Espacio_Comercial.nombre_zona = Zonas.nombre_zona
WHERE 
    Espacio_Comercial.estado = <4>;

```

*Donde el valor seleccionado en <4> es utilizado para realizar la búsqueda de los espacios comerciales con el respectivo tipo de estado*

| Codigo Requerimiento  |R-11| 
|-----------------------|-------|
| Codigo Interfaz       |I-011, I-013, I-014|
| Imagen interfaz       |![image](I013.png)| 
| Imagen interfaz       |![image](I014.png)|
| Imagen interfaz       |![image](I015.png)|


## Sentencias SQL
### Eventos:
* **Carga de la pagina inicial:** Se llenará la tabla de todos los contratos dentro de MallPlaza
```sql
SELECT
    ca.id_contrato AS "Nro Contrato",
    p.nombre AS "Inquilino",
    ec.tipo_inmueble AS "Inmueble",
    ca.fecha_inicio AS "Fecha Inicio",
    ca.fecha_vencimiento AS "Fecha Fin",
    ca.estado AS "Estado",
    ca.monto AS "Monto Renta"
FROM
    Contrato_Alquiler ca
JOIN
    Espacio_Comercial ec ON ca.id_espacio_comercial = ec.id_espacio_comercial
JOIN
    Inquilino i ON ec.id_espacio_comercial = i.id_espacio_comercial
JOIN
    Persona p ON i.id_persona = p.id_persona
ORDER BY
    ca.id_contrato;

```

* **Seleccion de contrato :** El usuario elegirá cualquier contrato para poder visualizar todos sus detalles.
```sql
SELECT * FROM Contrato_Alquiler
WHERE id_contrato = <1>;
    
```

*Donde <1> representa el id del contrato de alquiler de un inquilino*

* **Editar contrato :** El usuario tendrá la opcion de editar el contrato seleccionado.
```sql
UPDATE Contrato_Alquiler
SET fecha_inicio = <8> 
    fecha_vencimiento = <9>
    estado = <5>
    porcentaje = <6>
    zona = <2>
    tipo_inmueble = <4>
WHERE id_inquilino = 'I001'; -- ejemplo

```






| Codigo Requerimiento  |R-012| 
|-----------------------|-------|
| Codigo Interfaz       |I-019| 
| Imagen interfaz       |![image](I019.png)|

## Sentencias SQL
### Eventos:
* **Carga de la página de Inquilinos:** Se llenará la tabla de los inquilinos vigentes en MallPlaza
```sql
SELECT i.id_inquilino,
		p.nombre as "Nombre",
		i.razon_social as "Razón Social",
		p.nro_documento as "RUC",
		c.nombre_zona as "Espacio Comercial",
		t.telefono as "Teléfono",
		e.email as "Email",
		i.estado_inquilino as "Estado Inquilino"
FROM inquilino i
JOIN persona p
	ON i.id_persona = p.id_persona
JOIN persona_email e
	ON p.id_persona = e.id_persona
JOIN persona_telefono t
	ON p.id_persona = t.id_persona
JOIN espacio_comercial c
	ON i.id_espacio_comercial = c.id_espacio_comercial;
```

* **Búsqueda de Inquilino:** El usuario ingresará el texto en la barra de búsqueda para realizar la consulta correspondiente según el atributo que haya seleccionado en el filtro.
```sql
SELECT i.id_inquilino,
		p.nombre as "Nombre",
		i.razon_social as "Razón Social",
		p.nro_documento as "RUC",
		c.nombre_zona as "Espacio Comercial",
		t.telefono as "Teléfono",
		e.email as "Email",
		i.estado_inquilino as "Estado Inquilino"
FROM inquilino i
JOIN persona p
	ON i.id_persona = p.id_persona
JOIN persona_email e
	ON p.id_persona = e.id_persona
JOIN persona_telefono t
	ON p.id_persona = t.id_persona
JOIN espacio_comercial c
	ON i.id_espacio_comercial = c.id_espacio_comercial
WHERE 	id_inquilino = <1> OR
		p.nombre = <1> OR
		i.razon_social = <1> OR
		p.nro_documento = <1>;
```

*Donde el valor ingresado en <1> se captura y se realiza la búsqueda según la opción que se seleccionó en <2>*

| Codigo Requerimiento  |R-013| 
|-----------------------|-------|
| Codigo Interfaz       |I-021, I-022| 
| Imagen interfaz       |![image](I021.png)|
| Imagen interfaz       |![image](I022.png)|

## Sentencias SQL
### Eventos:
* **Carga de página:** Se llenará la tabla de los inquilinos vigentes en MallPlaza.
```sql
SELECT * FROM inquilinos_tabla; --Vista creada en la base de datos
```
* **Boton Editar:** Cuando el usuario seleccione el inquilino que quiera editar y presione el botón "Editar" se abrirá una ventana emergente con los datos de ese inquilino.
```sql
SELECT * FROM inquilinos_tabla
WHERE id_inquilino = <2>
```
*Donde <2> representa el id del inquilino seleccionado para realizar la búsqueda del inquilino a editar*
* **Editar Datos de Inquilino:** El usuario selecciona los datos principales del inquilino que quiera modificar, luego el usuario podrá dar al botón "Aceptar".
```sql
UPDATE inquilinos_tabla
SET nombre = <1>,
    razon_social = <2>,
    ruc = <3>,
    espacio_comercial = <4>,
    telefono = <5>,
    email = <6>,
    estado_inquilino = <7>
WHERE id_inquilino = 'I001'; --ejemplo
```
| Codigo Requerimiento  |R-013| 
|-----------------------|-------|
| Codigo Interfaz       |I-021, I-023| 
| Imagen interfaz       |![image](I021.png)|
| Imagen interfaz       |![image](I023.png)|

## Sentencias SQL
### Eventos:
* **Carga de Datos:** Se llenará la tabla de los inquilinos vigentes en MallPlaza.
```sql
SELECT * FROM inquilinos_tabla; --Vista creada en la base de datos
```
* **Boton Eliminar:** Cuando el usuario seleccione el inquilino que quiera eliminar y presione el botón "Eliminar" se abrirá una ventana emergente con los datos de ese inquilino.
```sql
SELECT * FROM inquilinos_tabla
WHERE id_inquilino = <2>
```
*Donde <2> representa el id del inquilino seleccionado para realizar la búsqueda del inquilino a editar*
* **Eliminar registro de Inquilino:** El usuario podrá ver la información del inquilino antes de confirmar y presionar el botón de "Eliminar"
```sql
DELETE FROM inquilinos
WHERE id_inquilino = <2>;
```
*Donde <2> representa el id del inquilino seleccionado para realizar la búsqueda del inquilino a editar*
